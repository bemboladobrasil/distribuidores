<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Distribuidores · Bem Bolado</title>
<style>
  :root {
    --bg: #ffffff;
    --card: #f9f9f9;
    --text: #3d0066;
    --muted: #7a7a7a;
    --accent: #9c27b0;
    --border: #e0e0e0;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background: var(--bg);
    color: var(--text);
  }
  header {
    position: sticky; top: 0; z-index: 10;
    backdrop-filter: blur(8px);
    background: rgba(15,17,21,0.7);
    border-bottom: 1px solid var(--border);
  }
  .wrap { max-width: 1100px; margin: 0 auto; padding: 16px 20px; }
  h1 { margin: 4px 0 8px; font-size: 20px; letter-spacing: .3px; }
  .controls {
    display: grid; gap: 10px; grid-template-columns: 1fr 1fr 1fr auto;
  }
  .controls input, .controls select {
    width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--card); color: var(--text);
    outline: none;
  }
  .controls button {
    padding: 10px 14px; border-radius: 12px; border: 1px solid var(--border); background: var(--card); color: var(--text); cursor: pointer;
  }
  .controls button:hover { border-color: var(--accent); }
  main .grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 14px; padding: 18px 20px;
  }
  .card {
    border: 1px solid var(--border); border-radius: 16px; background: linear-gradient(180deg, #151922, #12151c);
    padding: 14px;
  }
  .uf-pill {
    display:inline-block; font-size:12px; color:#fff; background: var(--accent); padding: 2px 8px; border-radius: 999px; margin-bottom: 8px;
  }
  .empresa { font-weight: 700; font-size: 16px; }
  .sub { color: var(--muted); font-size: 13px; margin: 2px 0 8px; }
  .area { font-size: 12px; color: var(--muted); margin-top: 8px; }
  .actions { display:flex; flex-wrap: wrap; gap:8px; margin-top: 10px; }
  .btn {
    border: 1px solid var(--border); background: #10131a; color: var(--text); padding: 8px 10px; border-radius: 10px; font-size: 13px; text-decoration: none;
  }
  .btn:hover { border-color: var(--accent); }
  footer { color: var(--muted); font-size: 12px; padding: 10px 20px 24px; text-align: center; }
  @media print {
    header, .controls, footer { display:none; }
    body { background: #fff; color:#000; }
    .card { break-inside: avoid; page-break-inside: avoid; }
  }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Distribuidores · Bem Bolado</h1>
    <div class="controls">
      <input id="q" type="search" placeholder="Buscar por nome, cidade, contato..." />
      <select id="uf"></select>
      <select id="secao"></select>
      <button id="btnPrint">Imprimir / Salvar PDF</button>
    </div>
  </div>
</header>
<main>
  <div class="wrap">
    <div id="resultCount" class="sub"></div>
  </div>
  <div class="grid" id="grid"></div>
</main>
<footer>
  Atualize os dados substituindo o arquivo JSON embutido neste HTML. Versão gerada automaticamente.
</footer>

<script>
let DATA = []; 
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQuyvyfHntOVoDyZe-xDOKeWTMb3hXGpnIoXk_tNozCAFNk94nbtvnxe-P60Mr5q4pyaewEhFoxHOqH/pub?output=csv";

function parseCSV(text) {
  const rows = [];
  let cur = '', row = [], i = 0, inQuotes = false;
  while (i < text.length) {
    const c = text[i];
    if (inQuotes) {
      if (c === '"') {
        if (text[i+1] === '"') { cur += '"'; i++; } else { inQuotes = false; }
      } else { cur += c; }
    } else {
      if (c === '"') inQuotes = true;
      else if (c === ',') { row.push(cur); cur = ''; }
      else if (c === '\n') { row.push(cur); rows.push(row); row = []; cur = ''; }
      else if (c !== '\r') { cur += c; }
    }
    i++;
  }
  if (cur.length>0 || row.length>0) { row.push(cur); rows.push(row); }
  return rows;
}
function csvToObjects(csvText) {
  const rows = parseCSV(csvText);
  if (!rows.length) return [];
  const headers = rows[0].map(h => (h||'').trim());
  return rows.slice(1).filter(r => r.some(x => (x||'').trim() !== '')).map(r => {
    const obj = {};
    headers.forEach((h, idx) => obj[h] = (r[idx] || '').trim());
    return obj;
  });
}
async function loadCSV() {
  try {
    const res = await fetch(CSV_URL);
    if (!res.ok) throw new Error("Falha ao buscar CSV ("+res.status+")");
    const text = await res.text();
    const rows = csvToObjects(text);
    // Normaliza campos esperados pelo site
    DATA = rows.map(r => ({
      UF: r.UF || "",
      SECAO: r.SECAO || r["SEÇÃO"] || "",
      REPRESENTANTE: r.REPRESENTANTE || "",
      NOME: r.NOME || "",
      TELEFONE: r.TELEFONE || "",
      WHATSAPP: r.WHATSAPP || "",
      EMAIL: r.EMAIL || r["E-MAIL"] || "",
      INSTAGRAM: r.INSTAGRAM || "",
      AREA_ATENDIMENTO: r.AREA_ATENDIMENTO || r["AREA DE ATENDIMENTO"] || ""
    }));
    rebuildSecaoOptions();
    render();
  } catch (e) {
    console.error(e);
    document.getElementById("grid").innerHTML =
      "<div class='sub'>Erro ao carregar dados do Google Sheets. Verifique o link CSV.</div>";
  }
}
// dispara o carregamento assim que a página abre
loadCSV();

function onlyDigits(s) {
  return (s||"").replace(/\D+/g, "");
}
function splitMulti(s) {
  if (!s) return [];
  return String(s).split(/\s*[\/|,;]\s*/).map(x => x.trim()).filter(Boolean);
}
function unique(arr) { return [...new Set(arr)]; }

const $q = document.getElementById("q");
const $uf = document.getElementById("uf");
const $secao = document.getElementById("secao");
const $grid = document.getElementById("grid");
const $resultCount = document.getElementById("resultCount");
document.getElementById("btnPrint").onclick = () => window.print();

// Build UF options
const allUFs = unique(DATA.map(r => r.UF).filter(Boolean)).sort();
$uf.innerHTML = '<option value="">Todos os estados</option>' + allUFs.map(uf => `<option value="${uf}">${uf}</option>`).join("");

// Build Seção options (depends on UF)
function rebuildSecaoOptions() {
  const uf = $uf.value;
  const secoes = unique(DATA.filter(r => !uf || r.UF===uf).map(r => r.SECAO || "").filter(Boolean)).sort();
  $secao.innerHTML = '<option value="">Todas as seções</option>' + secoes.map(s => `<option>${s}</option>`).join("");
}
$uf.onchange = () => { rebuildSecaoOptions(); render(); };
$secao.onchange = () => render();
$q.oninput = () => render();

function buildCard(r) {
  const empresa = r.REPRESENTANTE || r.NOME || "(sem nome)";
  const cidade = r.CIDADE || "";
  const contato = r.NOME || "";
  const telList = splitMulti(r.TELEFONE);
  const whatsList = splitMulti(r.WHATSAPP);
  const email = (r.EMAIL || "").trim();
  const insta = (r.INSTAGRAM || "").trim();
  const area = (r.AREA_ATENDIMENTO || "").trim();

  const btns = [];
  telList.forEach(t => {
    const d = onlyDigits(t);
    if (d) btns.push(`<a class="btn" href="tel:${d}">Ligar ${t}</a>`);
  });
  whatsList.forEach(w => {
    const d = onlyDigits(w);
    if (d) btns.push(`<a class="btn" target="_blank" href="https://wa.me/55${d}">WhatsApp</a>`);
  });
  if (email) btns.push(`<a class="btn" href="mailto:${email}">E-mail</a>`);
  if (insta) {
    const url = insta.startsWith("http") ? insta : `https://instagram.com/${insta.replace(/^@/,"")}`;
    btns.push(`<a class="btn" target="_blank" href="${url}">Instagram</a>`);
  }

  return `
    <div class="card">
      <div class="uf-pill">${r.UF}</div>
      <div class="empresa">${empresa}</div>
      <div class="sub">${contato ? "Contato: "+contato+" · " : ""}${cidade || ""}${r.SECAO ? " · "+r.SECAO : ""}</div>
      ${ area ? `<div class="area"><strong>Área de atendimento:</strong> ${area}</div>` : "" }
      <div class="actions">${btns.join(" ")}</div>
    </div>
  `;
}

function render() {
  const uf = $uf.value.trim();
  const secao = $secao.value.trim();
  const q = ($q.value || "").toLowerCase();

  let rows = DATA.filter(r => (!uf || r.UF===uf) && (!secao || (r.SECAO||"")===secao));
  if (q) {
    rows = rows.filter(r => {
      const blob = (r.REPRESENTANTE + " " + r.NOME + " " + (r.CIDADE||"") + " " + (r.EMAIL||"") + " " + (r.INSTAGRAM||"") + " " + (r.AREA_ATENDIMENTO||"")).toLowerCase();
      return blob.includes(q);
    });
  }
  $resultCount.textContent = rows.length + " resultado" + (rows.length===1 ? "" : "s");
  $grid.innerHTML = rows.map(buildCard).join("");
}

rebuildSecaoOptions();
render();
</script>
</body>
</html>
