<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Distribuidores · Bem Bolado</title>
<style>
body{margin:0;font-family:sans-serif;background:#f9f9fb;color:#222}
header{background:#7e3af2;color:#fff;padding:20px;text-align:center}
h1{margin:0}
.controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px}
.controls input,.controls select,.controls button{
  padding:10px 14px;border-radius:8px;border:1px solid #ccc;font-size:14px
}
.controls button{background:#7e3af2;color:#fff;border:none;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;padding:20px}
.card{background:#fff;border:1px solid #ddd;border-radius:10px;padding:14px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
.uf-pill{display:inline-block;background:#7e3af2;color:#fff;padding:3px 8px;border-radius:999px;font-size:12px;margin-bottom:8px}
.empresa{font-weight:700;font-size:16px;margin-bottom:4px}
.sub{color:#555;font-size:13px}
.area{color:#444;font-size:13px;margin-top:6px}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.btn{background:#7e3af2;color:#fff;padding:6px 10px;border-radius:6px;text-decoration:none;font-size:13px}
.btn:hover{background:#5f2fd1}
#resultWrap{text-align:center;color:#555;margin:10px 0}
</style>
</head>
<body>

<header>
  <h1>Distribuidores · Bem Bolado</h1>
  <div class="controls">
    <input id="q" type="search" placeholder="Buscar por nome, cidade, contato...">
    <select id="uf"><option value="">Todos os estados</option></select>
    <button id="btnPrint">Imprimir / PDF</button>
  </div>
</header>

<div id="resultWrap"><span id="resultCount"></span></div>
<main><div id="grid" class="grid"></div></main>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/1J-h2Gt9SgZWW_QeuU1u3i8kch9GzpWgdsbFyrbOcffE/export?format=csv&gid=0";

const $q=document.getElementById("q"),$uf=document.getElementById("uf"),$grid=document.getElementById("grid"),$resultCount=document.getElementById("resultCount");
document.getElementById("btnPrint").onclick=()=>window.print();

function onlyDigits(s){return(s||"").replace(/\D+/g,"")}
function telHref(v){const d=onlyDigits(v);return d?`tel:${d}`:""}

function parseCSV(text){
  const rows=[];let cur='',row=[],i=0,inQ=false;
  while(i<text.length){
    const c=text[i];
    if(inQ){
      if(c=='"'){if(text[i+1]=='"'){cur+='"';i++;}else inQ=false;}
      else cur+=c;
    }else{
      if(c=='"')inQ=true;
      else if(c==','){row.push(cur);cur='';}
      else if(c=='\n'){row.push(cur);rows.push(row);row=[];cur='';}
      else if(c!='\r'){cur+=c;}
    }
    i++;
  }
  if(cur.length||row.length){row.push(cur);rows.push(row);}
  return rows;
}
function csvToObjects(csv){
  const rows=parseCSV(csv);if(!rows.length)return[];
  const head=rows[0].map(h=>(h||'').trim());
  return rows.slice(1).filter(r=>r.some(x=>(x||'').trim()!=='')).map(r=>{
    const o={};head.forEach((h,i)=>o[h]=(r[i]||'').trim());return o;
  });
}

let DATA=[];
async function loadCSV(){
  try{
    const res=await fetch(CSV_URL);if(!res.ok)throw new Error(res.status);
    const text=await res.text();const rows=csvToObjects(text);
    DATA=rows.map(r=>({
      UF:r.UF||"",NOME:r.NOME||"",REPRESENTANTE:r.REPRESENTANTE||"",
      TELEFONE:r.TELEFONE||"",WHATSAPP:r.WHATSAPP||"",EMAIL:r.EMAIL||r["E-MAIL"]||"",
      INSTAGRAM:r.INSTAGRAM||"",CIDADE:r.CIDADE||"",AREA_ATENDIMENTO:r.AREA_ATENDIMENTO||r["AREA DE ATENDIMENTO"]||""
    }));
    rebuildUFOptions();render();
  }catch(e){console.error(e);$grid.innerHTML="<div style='grid-column:1/-1;text-align:center;color:#888;'>Erro ao carregar planilha</div>";}
}

function rebuildUFOptions(){
  const ufs=[...new Set(DATA.map(r=>(r.UF||"").trim()).filter(Boolean))].sort();
  $uf.innerHTML='<option value="">Todos os estados</option>'+ufs.map(u=>`<option>${u}</option>`).join('');
}
$uf.onchange=()=>render();$q.oninput=()=>render();

function matchText(r,q){if(!q)return true;const hay=[r.UF,r.REPRESENTANTE,r.NOME,r.CIDADE,r.AREA_ATENDIMENTO,r.EMAIL,r.WHATSAPP,r.TELEFONE,r.INSTAGRAM].join(' ').toLowerCase();return hay.includes(q.toLowerCase());}

function buildCard(r){
  const emp=r.REPRESENTANTE||r.NOME||"(sem nome)";
  const contato=r.NOME?`Contato: ${r.NOME}`:(r.REPRESENTANTE?`Contato: ${r.REPRESENTANTE}`:"");
  const area=r.AREA_ATENDIMENTO?`Área de atendimento: <strong>${r.AREA_ATENDIMENTO}</strong>`:"";
  const fone=r.WHATSAPP||r.TELEFONE||"",btnTel=fone?`<a class="btn" href="${telHref(fone)}">Ligar (${fone})</a>`:"";
  const btnMail=r.EMAIL?`<a class="btn" href="mailto:${r.EMAIL}">E-mail</a>`:"";
  const ig=(r.INSTAGRAM||"").replace(/^@/,""),btnIG=ig?`<a class="btn" href="https://instagram.com/${ig}" target="_blank">Instagram</a>`:"";
  return `<div class="card"><div class="uf-pill">${r.UF||"--"}</div><div class="empresa">${emp}</div><div class="sub">${contato}</div><div class="area">${area}</div><div class="actions">${btnTel}${btnMail}${btnIG}</div></div>`;
}

function render(){
  const q=$q.value.trim(),ufSel=$uf.value||"";
  const list=DATA.filter(r=>(!ufSel||r.UF===ufSel)&&matchText(r,q));
  $resultCount.textContent=`${list.length} resultado${list.length==1?"":"s"}`;
  $grid.innerHTML=list.length?list.map(buildCard).join(""):`<div style="grid-column:1/-1;text-align:center;color:#888;">Nenhum distribuidor encontrado</div>`;
}
loadCSV();
</script>

</body>
</html>
